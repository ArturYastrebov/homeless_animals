{% extends "homeless_animals/base.html" %}
{% block title %}
    <title>
        Registration
    </title>
{% endblock %}

{% block content %}

    <div class="grid text-left" style="margin-left: 15%; margin-right: 25%">
        <h1>
            Show homeless animals on Google maps
        </h1>
        <hr>
        <div id="map" style="height: 600px; width: 800px;"></div>
        <script>
            // Initialize and add the map
            function initMap() {
                // The location of Uluru
                const uluru = {lat: 50.457084670428856, lng: 30.519846638514196};

                // The map, centered at Uluru
                const map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 13,
                    center: uluru,
                });

                // ajax call
                function ajaxCall() {
                    $.ajax({
                        // Our sample url to make request
                        url:
                            '/api/v1/animals/',
                        // Type of Request
                        type: "GET",
                        // Function to call when to
                        // request is ok
                        success: function (data) {
                            var x = data;
                            let list_res = []
                            for (let i = 0; i < x['animals'].length; i++) {
                              list_res.push([x['animals'][i]['coordinates'],x['animals'][i]['species']]);
                            }
                            console.log(list_res);
                            db_markers = list_res
                            var index;
                            for (index = db_markers.length - 1; index >= 0; --index) {
                                addMarker(db_markers[index][0], db_markers[index][1])
                            }
                        },
                        // Error handling
                        error: function (error) {
                            console.log(`Error ${error}`);
                        }

                    });
                }
                ajaxCall();
                // The marker, positioned at Uluru
                var db_markers = [
                    [{lat: 50.454371, lng: 30.502812}, 'Fox'],
                    [{lat: 50.441127, lng: 30.538153}, 'Red'],
                    [{lat: 50.446127, lng: 30.532153}, 'Humer'],
                    [{lat: 50.436527, lng: 30.532153}, 'Lera'],
                    [{lat: 50.446227, lng: 30.512153}, 'Goha'],
                ];
                var index;
                for (index = db_markers.length - 1; index >= 0; --index) {
                    addMarker(db_markers[index][0], db_markers[index][1])}

                function addMarker(coordinates, title) {
                    var marker = new google.maps.Marker({
                        position: coordinates,
                        title: title,
                        map: map,
                    });
                }
            }

            window.initMap = initMap;
        </script>
        <script async
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFILT2NLze2t6r-6GJLSvDC1wR7iE8beM&callback=initMap">
        </script>

    </div>
{% endblock %}